import{T as N}from"./index-7dcea9ba.js";import{B as R}from"./index-3b59ee0e.js";import{f as W,g as A,o as b,c as j,d as f,a as d,u as m,w as C,e as E,t as D,_ as $}from"./app-fcfb95bc.js";import"./useConfigInject-ecfa0aa8.js";import"./LoadingOutlined-a1b96c11.js";import"./ResizeObserver.es-f4289e8a.js";var l=(e=>(e[e.DATA=0]="DATA",e[e.RCDATA=1]="RCDATA",e[e.RAWTEXT=2]="RAWTEXT",e))(l||{});let B=class{constructor(s,t){this.consume=n=>{this.source=this.source.slice(n)},this.consumeSpace=()=>{const n=/^[\t\r\n\f\s ]*/.exec(this.source);n&&this.consume(n[0].length)},this.source=s,this.mode=t}};const X=e=>new B(e,0);var a=(e=>(e.ROOT="ROOT",e.ELEMENT="ELEMENT",e.COMMENT="COMMENT",e.TEXT="TEXT",e.INTERPOLATION="INTERPOLATION",e.EXPRESSION="EXPRESSION",e.ATTRIBUTE="ATTRIBUTE",e.DIRECTIVE="DIRECTIVE",e))(a||{});const k=(e,s)=>{if(!e.source)return!0;for(let t=s.length-1;t>=0;--t)if(e.source.startsWith(`</${s[t].tag}`))return!0;return!1},F=(e,s)=>{const t=I(e);if(t){if(t.isSelfClosing)return t;t.tag==="textarea"||t.tag==="title"?e.mode=l.RCDATA:t.tag&&/style|xmp|iframe|noembed|noframes|noscript/.test(t.tag)?e.mode=l.RAWTEXT:e.mode=l.DATA,s.push(t),t.children=S(e,s),s.pop(),e.source.startsWith(`</${t.tag}`)?I(e,!0):console.error(`${t.tag} 标签缺少闭合标签`)}return t},V=e=>{const{consume:s,consumeSpace:t}=e,n=[];for(;!e.source.startsWith(">")&&!e.source.startsWith("/>");){const r=/^[^\t\n\r\f />][^\t\n\r\f />=]*/.exec(e.source);if(r){const o=r[0];s(o.length),t(),s(1),t();let i="";const c=e.source[0];if(c==="'"||c==='"'){s(1);const p=e.source.indexOf(c);p>-1?(i=e.source.slice(0,p),s(i.length),s(1)):console.error("缺少引号")}else{const p=/^[^\t\n\r\f />]+/.exec(e.source);p?(i=p[0],s(i.length)):console.error("不合法的属性值")}t(),n.push({type:o.startsWith("v-")||o.startsWith(":")||o.startsWith("@")?a.DIRECTIVE:a.ATTRIBUTE,name:o,value:i})}else console.error("不合法的属性名")}return n},I=(e,s=!1)=>{const{consume:t,consumeSpace:n}=e,r=s?/^<\/([a-z][^\t\n\r\f />]*)/i.exec(e.source):/^<([a-z][^\t\n\r\f />]*)/i.exec(e.source);if(r){const o=r[1];t(r[0].length),n();const i=V(e),c=e.source.startsWith("/>");return t(c?2:1),n(),{type:a.ELEMENT,children:[],props:i,tag:o,isSelfClosing:c}}console.error("不合法的标签")},M=e=>{const{consume:s}=e;s(4);const t=e.source.indexOf("-->");t<0&&console.error("缺少注释界定符");const n=e.source.slice(0,t);return s(n.length),s(3),{type:a.COMMENT,content:n}},G=e=>{const{consume:s}=e;s(2);const t=e.source.indexOf("}}");t<0&&console.error("缺少插值界定符");const n=e.source.slice(0,t);return s(n.length),s(2),{type:a.INTERPOLATION,content:{type:a.EXPRESSION,content:n}}},z=e=>{const{consume:s}=e;let t=e.source.length;const n=e.source.indexOf("<"),r=e.source.indexOf("{{");n>-1&&n<t&&(t=n),r>-1&&r<t&&(t=r);const o=e.source.slice(0,t);return s(o.length),{type:a.TEXT,content:o}},S=(e,s)=>{const t=[];for(;!k(e,s);){let n;if(e.mode===l.DATA||e.mode===l.RCDATA){const{mode:r,source:o}=e;if(r===l.DATA&&e.source[0]==="<")if(o[1]==="!")o.startsWith("<!--")&&(n=M(e));else if(o[1]==="/"){console.error("无效的结束标签");continue}else/[a-z]/i.test(o[1])&&(n=F(e,s));else o.startsWith("{{")&&(n=G(e))}n||(n=z(e)),t.push(n)}return t},Q=e=>{const s=X(e),{consumeSpace:t}=s;t();const n=S(s,[]);return{type:a.ROOT,children:n}};let J=class{constructor(s,t,n,r){this.currentNode=s,this.childIndex=t,this.parent=n,this.plugins=r}};const q=(e,s=null,t=0,n=null)=>new J(s,t,n,e),L=(e,s)=>{s.currentNode=e;const t=[];s.plugins.forEach(i=>{const c=i(e,s);c&&t.push(c)});const r=s.currentNode.children;r&&r.forEach((i,c)=>{s.parent=s.currentNode,s.childIndex=c,L(i,s)});let o=t.length;for(;o--;)t[o]()},v=(e,s)=>{const t=q(s);L(e,t)};var u=(e=>(e.FUNC="FUNC",e.STRING="STRING",e.ARRAY="ARRAY",e.CALL="CALL",e.RETURN="RETURN",e))(u||{});const U=e=>({type:"STRING",value:e}),y=e=>({type:"ARRAY",elements:e}),H=(e,s)=>({type:"CALL",value:e,arguments:s}),K=e=>({type:"RETURN",returnExpress:e}),P=(e,s,t)=>({type:"FUNC",body:s,value:e,params:t}),_=(e,s)=>{e.type==a.TEXT&&(e.jsNode=U(e.content))},w=(e,s)=>()=>{if(e.type===a.ELEMENT){const t=H("h",[U(e.tag)]);if(e.children)if(e.children.length===1)e.children[0]&&e.children[0].jsNode&&(t.arguments?t.arguments.push(e.children[0].jsNode):t.arguments=[e.children[0].jsNode]);else{const n=e.children.map(r=>r.jsNode).filter(r=>r);t.arguments?t.arguments.push(y(n)):t.arguments=[y(n)]}e.jsNode=t}},O=(e,s)=>()=>{if(e.type===a.ROOT&&e.children){const t=e.children[0].jsNode,n=K(t);e.jsNode=P("render",[n])}};class Z{constructor(s,t){this.push=n=>{this.code+=n},this.newLine=()=>{this.code+=`
`+"  ".repeat(this.currentIndent)},this.indent=()=>{this.currentIndent++,this.newLine()},this.deIndent=()=>{this.currentIndent--,this.newLine()},this.code=s,this.currentIndent=t}}const x=(e="",s=0)=>new Z(e,s),T=(e,s)=>{const{push:t}=s;e.forEach((n,r)=>{g(n,s),r<e.length-1&&t(", ")})},Y=(e,s)=>{const{push:t,indent:n,deIndent:r}=s;t(`function ${e.value}(`),e.params&&T(e.params,s),t(") {"),n(),e.body&&e.body.forEach(o=>g(o,s)),r(),t("}")},ee=(e,s)=>{const{push:t}=s;t("return "),e.returnExpress&&g(e.returnExpress,s)},se=(e,s)=>{const{push:t}=s,{value:n,arguments:r}=e;n&&(t(`${n}(`),r&&T(r,s),t(")"))},te=(e,s)=>{const{push:t}=s;t(`'${e.value}'`)},ne=(e,s)=>{const{push:t}=s;t("["),e.elements&&T(e.elements,s),t("]")},g=(e,s)=>{switch(e.type){case u.FUNC:Y(e,s);break;case u.RETURN:ee(e,s);break;case u.CALL:se(e,s);break;case u.STRING:te(e,s);break;case u.ARRAY:ne(e,s);break}},re=e=>{const s=x();return g(e,s),s.code},oe={class:"compiler-demo"},ie={class:"demo-content"},ce={class:"str-content"},ae={class:"action"},le={class:"res-content"},ue=W({__name:"CompilerDemo",props:{isParse:{type:Boolean,default:!1},isTransform:{type:Boolean,default:!1}},setup(e){const s=e,t=A(""),n=A(""),r=()=>{t.value="",n.value=""},o=()=>{const i=Q(t.value);!s.isParse&&!s.isTransform?(v(i,[_,O,w]),i.jsNode&&(n.value=re(i.jsNode))):s.isTransform?(v(i,[_,O,w]),n.value=JSON.stringify(i.jsNode)):n.value=JSON.stringify(i)};return(i,c)=>(b(),j("div",oe,[f("div",ie,[f("div",ce,[d(m(N),{value:t.value,"onUpdate:value":c[0]||(c[0]=h=>t.value=h),rows:5},null,8,["value"])]),f("div",ae,[d(m(R),{onClick:r},{default:C(()=>[E("Reset")]),_:1}),d(m(R),{onClick:o,type:"primary",class:"parse-btn"},{default:C(()=>[E(D(i.isParse?"Parse":i.isTransform?"Transform":"Compile"),1)]),_:1})]),f("div",le,[d(m(N),{value:n.value,"onUpdate:value":c[1]||(c[1]=h=>n.value=h),rows:5},null,8,["value"])])])]))}});const Re=$(ue,[["__scopeId","data-v-56cd1fcb"],["__file","CompilerDemo.vue"]]);export{Re as default};
