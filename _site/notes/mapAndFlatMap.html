<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1" /><title>Scala中的map、flatMap</title><meta name="twitter:card" content="summary" /><meta name="twitter:site" content="@HeiswayiNrird" /><meta name="twitter:title" content="Scala中的map、flatMap" /><meta name="twitter:description" content="Scala 中的 map 和 flatMap 在开发中用处很多，功能也十分强大，本文将详细介绍 Scala中 map 和 flatMap 的常见用法以及 map 和 flatMap 的区别。"><meta name="description" content="Scala 中的 map 和 flatMap 在开发中用处很多，功能也十分强大，本文将详细介绍 Scala中 map 和 flatMap 的常见用法以及 map 和 flatMap 的区别。"><link rel="icon" href="/assets/favicon.png"><link rel="apple-touch-icon" href="/assets/touch-icon.png"><style> /* latin-ext */ @font-face { font-family: 'Karla'; font-style: normal; font-weight: 400; src: local('Karla'), local('Karla-Regular'), url(https://fonts.gstatic.com/s/karla/v5/S1bXQ0LrY7AzefpgNae9sYDGDUGfDkXyfkzVDelzfFk.woff2) format('woff2'); unicode-range: U+0100-024F, U+1E00-1EFF, U+20A0-20AB, U+20AD-20CF, U+2C60-2C7F, U+A720-A7FF; } /* latin */ @font-face { font-family: 'Karla'; font-style: normal; font-weight: 400; src: local('Karla'), local('Karla-Regular'), url(https://fonts.gstatic.com/s/karla/v5/JaMH4jmmzP070-OYo03anaCWcynf_cDxXwCLxiixG1c.woff2) format('woff2'); unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2212, U+2215; }</style><link rel="stylesheet" href="/assets/core.css"><link rel="canonical" href="/notes/mapAndFlatMap"><link rel="alternate" type="application/atom+xml" title="ShawDubie" href="/feed.xml" /></head><body><aside class="logo"> <a href="/"> <img src="../assets/img/shaw.jpeg" class="gravatar"> </a> <span class="logo-prompt">Back to Home</span></aside><main> <noscript><style> article .footnotes { display: block; }</style></noscript><article><div class="center"><h1>Scala中的map、flatMap</h1><time>March 26, 2016</time></div><div class="divider"></div><p><code class="highlighter-rouge">Scala</code> 中的 <code class="highlighter-rouge">map</code> 和 <code class="highlighter-rouge">flatMap</code> 在开发中用处很多，功能也十分强大，本文将详细介绍 <code class="highlighter-rouge">Scala</code>中 <code class="highlighter-rouge">map</code> 和 <code class="highlighter-rouge">flatMap</code> 的常见用法以及 <code class="highlighter-rouge">map</code> 和 <code class="highlighter-rouge">flatMap</code> 的区别。</p><h2 id="map">map</h2><p>在某一个<code class="highlighter-rouge">列表（List）</code>调用 <code class="highlighter-rouge">map</code> 时，<code class="highlighter-rouge">map</code> 可以接受一个<code class="highlighter-rouge">函数</code>或者一个<code class="highlighter-rouge">表达式</code>为参数，这个<code class="highlighter-rouge">函数</code>或者<code class="highlighter-rouge">表达式</code>将作用于<code class="highlighter-rouge">列表</code>中的每一个元素，最终返回一个新的<code class="highlighter-rouge">列表（List）</code>。</p><div class="language-scala highlighter-rouge"><pre class="highlight"><code><span class="n">scala</span><span class="o">&gt;</span> <span class="k">val</span> <span class="n">list</span> <span class="k">=</span> <span class="nc">List</span><span class="o">(</span><span class="mi">1</span><span class="o">,</span><span class="mi">2</span><span class="o">,</span><span class="mi">3</span><span class="o">,</span><span class="mi">4</span><span class="o">,</span><span class="mi">5</span><span class="o">,</span><span class="mi">6</span><span class="o">)</span>

<span class="n">scala</span><span class="o">&gt;</span> <span class="n">list</span><span class="o">.</span><span class="n">map</span><span class="o">(</span><span class="k">_</span> <span class="o">*</span> <span class="mi">3</span><span class="o">)</span>
<span class="n">res0</span><span class="k">:</span> <span class="kt">List</span><span class="o">[</span><span class="kt">Int</span><span class="o">]</span> <span class="k">=</span> <span class="nc">List</span><span class="o">(</span><span class="mi">3</span><span class="o">,</span> <span class="mi">6</span><span class="o">,</span> <span class="mi">9</span><span class="o">,</span> <span class="mi">12</span><span class="o">,</span> <span class="mi">15</span><span class="o">,</span> <span class="mi">18</span><span class="o">)</span>
</code></pre></div><p>或者</p><div class="language-scala highlighter-rouge"><pre class="highlight"><code><span class="n">scala</span><span class="o">&gt;</span> <span class="k">def</span> <span class="n">f</span><span class="o">(</span><span class="n">x</span><span class="k">:</span> <span class="kt">Int</span><span class="o">)</span> <span class="k">=</span> <span class="n">x</span> <span class="o">*</span> <span class="mi">2</span>

<span class="n">scala</span><span class="o">&gt;</span> <span class="n">list</span><span class="o">.</span><span class="n">map</span><span class="o">(</span><span class="n">x</span> <span class="k">=&gt;</span> <span class="n">f</span><span class="o">(</span><span class="n">x</span><span class="o">))</span>
<span class="n">res1</span><span class="k">:</span> <span class="kt">List</span><span class="o">[</span><span class="kt">Int</span><span class="o">]</span> <span class="k">=</span> <span class="nc">List</span><span class="o">(</span><span class="mi">2</span><span class="o">,</span> <span class="mi">4</span><span class="o">,</span> <span class="mi">6</span><span class="o">,</span> <span class="mi">8</span><span class="o">,</span> <span class="mi">10</span><span class="o">,</span> <span class="mi">12</span><span class="o">)</span>
</code></pre></div><h2 id="flatmap">flatMap</h2><p><code class="highlighter-rouge">flatMap</code> 也可以传入一个<code class="highlighter-rouge">函数</code>，但是这个<code class="highlighter-rouge">函数</code>的返回值类型必须是 <code class="highlighter-rouge">List</code>、<code class="highlighter-rouge">Seq</code> 或者 <code class="highlighter-rouge">Option</code>，否则会出错。</p><p><code class="highlighter-rouge">f(x)</code> 的返回值是 <code class="highlighter-rouge">Int</code>，不是 <code class="highlighter-rouge">List</code> 也不是 <code class="highlighter-rouge">Option</code>，所以会报错。</p><div class="language-scala highlighter-rouge"><pre class="highlight"><code><span class="n">scala</span><span class="o">&gt;</span> <span class="n">list</span><span class="o">.</span><span class="n">flatMap</span><span class="o">(</span> <span class="n">x</span> <span class="k">=&gt;</span> <span class="n">f</span><span class="o">(</span><span class="n">x</span><span class="o">))</span>
<span class="o">&lt;</span><span class="n">console</span><span class="k">&gt;:</span><span class="mi">13</span><span class="k">:</span> <span class="kt">error:</span> <span class="k">type</span> <span class="kt">mismatch</span><span class="o">;</span>
 <span class="n">found</span>   <span class="k">:</span> <span class="kt">Int</span>
 <span class="n">required</span><span class="k">:</span> <span class="kt">scala.collection.GenTraversableOnce</span><span class="o">[</span><span class="kt">?</span><span class="o">]</span>
       <span class="n">list</span><span class="o">.</span><span class="n">flatMap</span><span class="o">(</span> <span class="n">x</span> <span class="k">=&gt;</span> <span class="n">f</span><span class="o">(</span><span class="n">x</span><span class="o">))</span>
                           <span class="o">^</span>
</code></pre></div><p><code class="highlighter-rouge">f(x)</code> 的返回值类型是 <code class="highlighter-rouge">Option</code></p><div class="language-scala highlighter-rouge"><pre class="highlight"><code><span class="n">scala</span><span class="o">&gt;</span> <span class="n">list</span><span class="o">.</span><span class="n">flatMap</span><span class="o">(</span><span class="n">x</span> <span class="k">=&gt;</span> <span class="nc">Some</span><span class="o">(</span><span class="n">x</span> <span class="o">*</span> <span class="mi">1</span><span class="o">))</span>
<span class="n">res5</span><span class="k">:</span> <span class="kt">List</span><span class="o">[</span><span class="kt">Int</span><span class="o">]</span> <span class="k">=</span> <span class="nc">List</span><span class="o">(</span><span class="mi">1</span><span class="o">,</span> <span class="mi">2</span><span class="o">,</span> <span class="mi">3</span><span class="o">,</span> <span class="mi">4</span><span class="o">,</span> <span class="mi">5</span><span class="o">,</span> <span class="mi">6</span><span class="o">)</span>
</code></pre></div><p><code class="highlighter-rouge">f2(x)</code> 的返回值类型是 <code class="highlighter-rouge">List</code></p><div class="language-scala highlighter-rouge"><pre class="highlight"><code><span class="n">scala</span><span class="o">&gt;</span> <span class="k">def</span> <span class="n">f2</span><span class="o">(</span><span class="n">x</span><span class="k">:</span> <span class="kt">Int</span><span class="o">)</span> <span class="k">=</span> <span class="nc">List</span><span class="o">(</span><span class="n">x</span><span class="o">+</span><span class="mi">1</span><span class="o">,</span><span class="n">x</span><span class="o">,</span><span class="n">x</span><span class="o">-</span><span class="mi">1</span><span class="o">)</span>
<span class="n">f2</span><span class="k">:</span> <span class="o">(</span><span class="kt">x:</span> <span class="kt">Int</span><span class="o">)</span><span class="kt">List</span><span class="o">[</span><span class="kt">Int</span><span class="o">]</span>

<span class="n">scala</span><span class="o">&gt;</span> <span class="n">list</span><span class="o">.</span><span class="n">flatMap</span><span class="o">(</span><span class="n">f2</span><span class="o">(</span><span class="k">_</span><span class="o">))</span>
<span class="n">res7</span><span class="k">:</span> <span class="kt">List</span><span class="o">[</span><span class="kt">Int</span><span class="o">]</span> <span class="k">=</span> <span class="nc">List</span><span class="o">(</span><span class="mi">2</span><span class="o">,</span> <span class="mi">1</span><span class="o">,</span> <span class="mi">0</span><span class="o">,</span> <span class="mi">3</span><span class="o">,</span> <span class="mi">2</span><span class="o">,</span> <span class="mi">1</span><span class="o">,</span> <span class="mi">4</span><span class="o">,</span> <span class="mi">3</span><span class="o">,</span> <span class="mi">2</span><span class="o">,</span> <span class="mi">5</span><span class="o">,</span> <span class="mi">4</span><span class="o">,</span> <span class="mi">3</span><span class="o">,</span> <span class="mi">6</span><span class="o">,</span> <span class="mi">5</span><span class="o">,</span> <span class="mi">4</span><span class="o">,</span> <span class="mi">7</span><span class="o">,</span> <span class="mi">6</span><span class="o">,</span> <span class="mi">5</span><span class="o">)</span>
</code></pre></div><h2 id="区别">区别</h2><p><code class="highlighter-rouge">map</code> 方法返回的是一个列表元素为列表的列表</p><div class="language-scala highlighter-rouge"><pre class="highlight"><code><span class="n">scala</span><span class="o">&gt;</span> <span class="k">val</span> <span class="n">list2</span> <span class="k">=</span> <span class="n">list</span><span class="o">.</span><span class="n">map</span><span class="o">(</span><span class="n">f2</span><span class="o">(</span><span class="k">_</span><span class="o">))</span>
<span class="n">list2</span><span class="k">:</span> <span class="kt">List</span><span class="o">[</span><span class="kt">List</span><span class="o">[</span><span class="kt">Int</span><span class="o">]]</span> <span class="k">=</span> <span class="nc">List</span><span class="o">(</span><span class="nc">List</span><span class="o">(</span><span class="mi">2</span><span class="o">,</span> <span class="mi">1</span><span class="o">,</span> <span class="mi">0</span><span class="o">),</span> <span class="nc">List</span><span class="o">(</span><span class="mi">3</span><span class="o">,</span> <span class="mi">2</span><span class="o">,</span> <span class="mi">1</span><span class="o">),</span> <span class="nc">List</span><span class="o">(</span><span class="mi">4</span><span class="o">,</span> <span class="mi">3</span><span class="o">,</span> <span class="mi">2</span><span class="o">),</span> <span class="nc">List</span><span class="o">(</span><span class="mi">5</span><span class="o">,</span> <span class="mi">4</span><span class="o">,</span> <span class="mi">3</span><span class="o">),</span> <span class="nc">List</span><span class="o">(</span><span class="mi">6</span><span class="o">,</span> <span class="mi">5</span><span class="o">,</span> <span class="mi">4</span><span class="o">),</span> <span class="nc">List</span><span class="o">(</span><span class="mi">7</span><span class="o">,</span> <span class="mi">6</span><span class="o">,</span> <span class="mi">5</span><span class="o">))</span>
</code></pre></div><p><code class="highlighter-rouge">flatMap</code> 方法返回的只是一个<code class="highlighter-rouge">列表（List）</code>。</p><div class="language-scala highlighter-rouge"><pre class="highlight"><code><span class="n">scala</span><span class="o">&gt;</span> <span class="n">list</span><span class="o">.</span><span class="n">flatMap</span><span class="o">(</span><span class="n">f2</span><span class="o">(</span><span class="k">_</span><span class="o">))</span>
<span class="n">res7</span><span class="k">:</span> <span class="kt">List</span><span class="o">[</span><span class="kt">Int</span><span class="o">]</span> <span class="k">=</span> <span class="nc">List</span><span class="o">(</span><span class="mi">2</span><span class="o">,</span> <span class="mi">1</span><span class="o">,</span> <span class="mi">0</span><span class="o">,</span> <span class="mi">3</span><span class="o">,</span> <span class="mi">2</span><span class="o">,</span> <span class="mi">1</span><span class="o">,</span> <span class="mi">4</span><span class="o">,</span> <span class="mi">3</span><span class="o">,</span> <span class="mi">2</span><span class="o">,</span> <span class="mi">5</span><span class="o">,</span> <span class="mi">4</span><span class="o">,</span> <span class="mi">3</span><span class="o">,</span> <span class="mi">6</span><span class="o">,</span> <span class="mi">5</span><span class="o">,</span> <span class="mi">4</span><span class="o">,</span> <span class="mi">7</span><span class="o">,</span> <span class="mi">6</span><span class="o">,</span> <span class="mi">5</span><span class="o">)</span>
</code></pre></div><p>或者</p><div class="language-scala highlighter-rouge"><pre class="highlight"><code><span class="n">scala</span><span class="o">&gt;</span> <span class="n">list2</span><span class="o">.</span><span class="n">flatMap</span><span class="o">(</span><span class="n">x</span> <span class="k">=&gt;</span> <span class="n">x</span><span class="o">)</span>
<span class="n">res31</span><span class="k">:</span> <span class="kt">List</span><span class="o">[</span><span class="kt">Int</span><span class="o">]</span> <span class="k">=</span> <span class="nc">List</span><span class="o">(</span><span class="mi">2</span><span class="o">,</span> <span class="mi">1</span><span class="o">,</span> <span class="mi">0</span><span class="o">,</span> <span class="mi">3</span><span class="o">,</span> <span class="mi">2</span><span class="o">,</span> <span class="mi">1</span><span class="o">,</span> <span class="mi">4</span><span class="o">,</span> <span class="mi">3</span><span class="o">,</span> <span class="mi">2</span><span class="o">,</span> <span class="mi">5</span><span class="o">,</span> <span class="mi">4</span><span class="o">,</span> <span class="mi">3</span><span class="o">,</span> <span class="mi">6</span><span class="o">,</span> <span class="mi">5</span><span class="o">,</span> <span class="mi">4</span><span class="o">,</span> <span class="mi">7</span><span class="o">,</span> <span class="mi">6</span><span class="o">,</span> <span class="mi">5</span><span class="o">)</span>
</code></pre></div><p>可以看到 <code class="highlighter-rouge">flatMap</code> 将列表内元素的 <code class="highlighter-rouge">外壳（List）</code> 去掉了，得到的是 <code class="highlighter-rouge">List</code> 中的元素，这个属性在 <code class="highlighter-rouge">Option</code> 中很有用，我们可以将 <code class="highlighter-rouge">Option</code> 看作是一个 <code class="highlighter-rouge">List</code>，只是其中要么只有一个元素，要么没有元素。</p><div class="language-scala highlighter-rouge"><pre class="highlight"><code><span class="n">scala</span><span class="o">&gt;</span> <span class="k">def</span> <span class="n">f3</span><span class="o">(</span><span class="n">x</span><span class="k">:</span> <span class="kt">Int</span><span class="o">)</span> <span class="k">=</span> <span class="k">if</span><span class="o">(</span><span class="n">x</span> <span class="o">==</span> <span class="mi">0</span><span class="o">)</span> <span class="nc">None</span> <span class="k">else</span> <span class="nc">Some</span><span class="o">(</span><span class="n">x</span><span class="o">)</span>
<span class="n">f3</span><span class="k">:</span> <span class="o">(</span><span class="kt">x:</span> <span class="kt">Int</span><span class="o">)</span><span class="kt">Option</span><span class="o">[</span><span class="kt">Int</span><span class="o">]</span>

<span class="n">scala</span><span class="o">&gt;</span> <span class="k">val</span> <span class="n">list2</span> <span class="k">=</span> <span class="nc">List</span><span class="o">(</span><span class="mi">0</span><span class="o">,</span><span class="mi">2</span><span class="o">,</span><span class="mi">4</span><span class="o">,</span><span class="mi">0</span><span class="o">,</span><span class="mi">5</span><span class="o">,</span><span class="mi">0</span><span class="o">,</span><span class="mi">6</span><span class="o">,</span><span class="mi">0</span><span class="o">)</span>
<span class="n">list2</span><span class="k">:</span> <span class="kt">List</span><span class="o">[</span><span class="kt">Int</span><span class="o">]</span> <span class="k">=</span> <span class="nc">List</span><span class="o">(</span><span class="mi">0</span><span class="o">,</span> <span class="mi">2</span><span class="o">,</span> <span class="mi">4</span><span class="o">,</span> <span class="mi">0</span><span class="o">,</span> <span class="mi">5</span><span class="o">,</span> <span class="mi">0</span><span class="o">,</span> <span class="mi">6</span><span class="o">,</span> <span class="mi">0</span><span class="o">)</span>

<span class="n">scala</span><span class="o">&gt;</span> <span class="n">list2</span><span class="o">.</span><span class="n">map</span><span class="o">(</span><span class="n">x</span> <span class="k">=&gt;</span> <span class="n">f3</span><span class="o">(</span><span class="n">x</span><span class="o">))</span>
<span class="n">res10</span><span class="k">:</span> <span class="kt">List</span><span class="o">[</span><span class="kt">Option</span><span class="o">[</span><span class="kt">Int</span><span class="o">]]</span> <span class="k">=</span> <span class="nc">List</span><span class="o">(</span><span class="nc">None</span><span class="o">,</span> <span class="nc">Some</span><span class="o">(</span><span class="mi">2</span><span class="o">),</span> <span class="nc">Some</span><span class="o">(</span><span class="mi">4</span><span class="o">),</span> <span class="nc">None</span><span class="o">,</span> <span class="nc">Some</span><span class="o">(</span><span class="mi">5</span><span class="o">),</span> <span class="nc">None</span><span class="o">,</span> <span class="nc">Some</span><span class="o">(</span><span class="mi">6</span><span class="o">),</span> <span class="nc">None</span><span class="o">)</span>

<span class="c1">//flatMap将None过滤掉了，将类型为Option的列表元素变成了Int类型，得到一个列表元素类型为Int的列表
</span><span class="n">scala</span><span class="o">&gt;</span> <span class="n">list2</span><span class="o">.</span><span class="n">flatMap</span><span class="o">(</span><span class="n">x</span> <span class="k">=&gt;</span> <span class="n">f3</span><span class="o">(</span><span class="n">x</span><span class="o">))</span>
<span class="n">res11</span><span class="k">:</span> <span class="kt">List</span><span class="o">[</span><span class="kt">Int</span><span class="o">]</span> <span class="k">=</span> <span class="nc">List</span><span class="o">(</span><span class="mi">2</span><span class="o">,</span> <span class="mi">4</span><span class="o">,</span> <span class="mi">5</span><span class="o">,</span> <span class="mi">6</span><span class="o">)</span>

<span class="c1">//map返回的List可能含有None，而flatMap返回的列表是不可能含有None的
</span></code></pre></div><p><code class="highlighter-rouge">map</code> 也可以操作单个数据类型为 <code class="highlighter-rouge">Option</code> 的值，返回的值类型也是 <code class="highlighter-rouge">Option</code>，若 <code class="highlighter-rouge">flatMap</code> 也想操作，传入的表达式和函数的返回值类型必须是 <code class="highlighter-rouge">Option</code>。</p><div class="language-scala highlighter-rouge"><pre class="highlight"><code><span class="n">scala</span><span class="o">&gt;</span> <span class="k">val</span> <span class="n">a</span> <span class="k">=</span> <span class="nc">Some</span><span class="o">(</span><span class="mi">1</span><span class="o">)</span>
<span class="n">a</span><span class="k">:</span> <span class="kt">Some</span><span class="o">[</span><span class="kt">Int</span><span class="o">]</span> <span class="k">=</span> <span class="nc">Some</span><span class="o">(</span><span class="mi">1</span><span class="o">)</span>

<span class="n">scala</span><span class="o">&gt;</span> <span class="n">a</span><span class="o">.</span><span class="n">map</span><span class="o">(</span><span class="k">_</span> <span class="o">*</span> <span class="mi">2</span><span class="o">)</span>
<span class="n">res12</span><span class="k">:</span> <span class="kt">Option</span><span class="o">[</span><span class="kt">Int</span><span class="o">]</span> <span class="k">=</span> <span class="nc">Some</span><span class="o">(</span><span class="mi">2</span><span class="o">)</span>
</code></pre></div><p><code class="highlighter-rouge">flatMap</code> 传入的表达式或者函数的返回值类型必须是 <code class="highlighter-rouge">Option</code>，否则会出错。</p><div class="language-scala highlighter-rouge"><pre class="highlight"><code><span class="n">scala</span><span class="o">&gt;</span> <span class="n">a</span><span class="o">.</span><span class="n">flatMap</span><span class="o">(</span><span class="k">_</span> <span class="o">*</span> <span class="mi">2</span><span class="o">)</span>
<span class="o">&lt;</span><span class="n">console</span><span class="k">&gt;:</span><span class="mi">12</span><span class="k">:</span> <span class="kt">error:</span> <span class="k">type</span> <span class="kt">mismatch</span><span class="o">;</span>
 <span class="n">found</span>   <span class="k">:</span> <span class="kt">Int</span>
 <span class="n">required</span><span class="k">:</span> <span class="kt">Option</span><span class="o">[</span><span class="kt">?</span><span class="o">]</span>
       <span class="n">a</span><span class="o">.</span><span class="n">flatMap</span><span class="o">(</span><span class="k">_</span> <span class="o">*</span> <span class="mi">2</span><span class="o">)</span>
                   <span class="o">^</span>

<span class="n">scala</span><span class="o">&gt;</span> <span class="n">a</span><span class="o">.</span><span class="n">flatMap</span><span class="o">(</span><span class="n">x</span> <span class="k">=&gt;</span> <span class="nc">Some</span><span class="o">(</span><span class="n">x</span><span class="o">*</span><span class="mi">2</span><span class="o">))</span>
<span class="n">res16</span><span class="k">:</span> <span class="kt">Option</span><span class="o">[</span><span class="kt">Int</span><span class="o">]</span> <span class="k">=</span> <span class="nc">Some</span><span class="o">(</span><span class="mi">2</span><span class="o">)</span>
</code></pre></div><p><code class="highlighter-rouge">map</code> 和 <code class="highlighter-rouge">flatMap</code> 也可以操作列表元素为 <code class="highlighter-rouge">元组(k -&gt; v)</code> 的列表，方法与上文提到的类似</p><p>用 <code class="highlighter-rouge">map</code> 将<code class="highlighter-rouge">函数</code>或者<code class="highlighter-rouge">表达式</code>应用到<code class="highlighter-rouge">元组</code>中</p><div class="language-scala highlighter-rouge"><pre class="highlight"><code><span class="n">scala</span><span class="o">&gt;</span> <span class="k">val</span> <span class="n">list3</span> <span class="k">=</span> <span class="nc">List</span><span class="o">((</span><span class="mi">1</span> <span class="o">-&gt;</span> <span class="mi">3</span><span class="o">),(</span><span class="mi">2</span> <span class="o">-&gt;</span> <span class="mi">4</span><span class="o">),(</span><span class="mi">3</span> <span class="o">-&gt;</span> <span class="mi">6</span><span class="o">),(</span><span class="mi">4</span> <span class="o">-&gt;</span> <span class="mi">8</span><span class="o">))</span>
<span class="n">list3</span><span class="k">:</span> <span class="kt">List</span><span class="o">[(</span><span class="kt">Int</span>, <span class="kt">Int</span><span class="o">)]</span> <span class="k">=</span> <span class="nc">List</span><span class="o">((</span><span class="mi">1</span><span class="o">,</span><span class="mi">3</span><span class="o">),</span> <span class="o">(</span><span class="mi">2</span><span class="o">,</span><span class="mi">4</span><span class="o">),</span> <span class="o">(</span><span class="mi">3</span><span class="o">,</span><span class="mi">6</span><span class="o">),</span> <span class="o">(</span><span class="mi">4</span><span class="o">,</span><span class="mi">8</span><span class="o">))</span>

<span class="n">scala</span><span class="o">&gt;</span> <span class="n">list3</span><span class="o">.</span><span class="n">map</span><span class="o">(</span><span class="n">x</span> <span class="k">=&gt;</span> <span class="o">(</span><span class="n">x</span><span class="o">.</span><span class="n">_1</span> <span class="o">-&gt;</span> <span class="n">x</span><span class="o">.</span><span class="n">_2</span><span class="o">*</span><span class="mi">2</span><span class="o">))</span>
<span class="n">res23</span><span class="k">:</span> <span class="kt">List</span><span class="o">[(</span><span class="kt">Int</span>, <span class="kt">Int</span><span class="o">)]</span> <span class="k">=</span> <span class="nc">List</span><span class="o">((</span><span class="mi">1</span><span class="o">,</span><span class="mi">6</span><span class="o">),</span> <span class="o">(</span><span class="mi">2</span><span class="o">,</span><span class="mi">8</span><span class="o">),</span> <span class="o">(</span><span class="mi">3</span><span class="o">,</span><span class="mi">12</span><span class="o">),</span> <span class="o">(</span><span class="mi">4</span><span class="o">,</span><span class="mi">16</span><span class="o">))</span>
</code></pre></div><p>用 <code class="highlighter-rouge">flatMap</code> 将<code class="highlighter-rouge">函数</code>或者<code class="highlighter-rouge">表达式</code>应用到<code class="highlighter-rouge">元组</code>中去的时候，返回值类型必须是 <code class="highlighter-rouge">List</code>、<code class="highlighter-rouge">Seq</code> 或者 <code class="highlighter-rouge">Option</code> 否则会出错</p><div class="language-scala highlighter-rouge"><pre class="highlight"><code><span class="n">scala</span><span class="o">&gt;</span> <span class="n">list3</span><span class="o">.</span><span class="n">flatMap</span><span class="o">(</span><span class="n">x</span> <span class="k">=&gt;</span> <span class="o">(</span><span class="n">x</span><span class="o">.</span><span class="n">_1</span> <span class="o">-&gt;</span> <span class="n">x</span><span class="o">.</span><span class="n">_2</span><span class="o">*</span><span class="mi">2</span><span class="o">))</span>
<span class="o">&lt;</span><span class="n">console</span><span class="k">&gt;:</span><span class="mi">12</span><span class="k">:</span> <span class="kt">error:</span> <span class="k">type</span> <span class="kt">mismatch</span><span class="o">;</span>
 <span class="n">found</span>   <span class="k">:</span> <span class="o">(</span><span class="kt">Int</span><span class="o">,</span> <span class="kt">Int</span><span class="o">)</span>
 <span class="n">required</span><span class="k">:</span> <span class="kt">scala.collection.GenTraversableOnce</span><span class="o">[</span><span class="kt">?</span><span class="o">]</span>
       <span class="n">list3</span><span class="o">.</span><span class="n">flatMap</span><span class="o">(</span><span class="n">x</span> <span class="k">=&gt;</span> <span class="o">(</span><span class="n">x</span><span class="o">.</span><span class="n">_1</span> <span class="o">-&gt;</span> <span class="n">x</span><span class="o">.</span><span class="n">_2</span><span class="o">*</span><span class="mi">2</span><span class="o">))</span>
                                <span class="o">^</span>
</code></pre></div><p>函数的返回值类型是 <code class="highlighter-rouge">List</code></p><div class="language-scala highlighter-rouge"><pre class="highlight"><code><span class="n">scala</span><span class="o">&gt;</span> <span class="k">def</span> <span class="n">f4</span><span class="o">(</span><span class="n">k</span><span class="k">:</span> <span class="kt">Int</span><span class="o">,</span><span class="n">v</span><span class="k">:</span> <span class="kt">Int</span><span class="o">)</span> <span class="k">=</span> <span class="nc">List</span><span class="o">((</span><span class="n">k</span><span class="o">-</span><span class="mi">1</span><span class="o">,</span><span class="n">v</span><span class="o">-</span><span class="mi">1</span><span class="o">),(</span><span class="n">k</span><span class="o">,</span><span class="n">v</span><span class="o">),(</span><span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="o">,</span><span class="n">v</span><span class="o">+</span><span class="mi">1</span><span class="o">))</span>
<span class="n">f4</span><span class="k">:</span> <span class="o">(</span><span class="kt">k:</span> <span class="kt">Int</span><span class="o">,</span> <span class="kt">v:</span> <span class="kt">Int</span><span class="o">)</span><span class="nc">List</span><span class="o">[(</span><span class="kt">Int</span>, <span class="kt">Int</span><span class="o">)]</span>

<span class="n">scala</span><span class="o">&gt;</span> <span class="n">list3</span><span class="o">.</span><span class="n">flatMap</span><span class="o">(</span><span class="n">x</span> <span class="k">=&gt;</span> <span class="n">f4</span><span class="o">(</span><span class="n">x</span><span class="o">.</span><span class="n">_1</span><span class="o">,</span><span class="n">x</span><span class="o">.</span><span class="n">_2</span><span class="o">))</span>
<span class="n">res25</span><span class="k">:</span> <span class="kt">List</span><span class="o">[(</span><span class="kt">Int</span>, <span class="kt">Int</span><span class="o">)]</span> <span class="k">=</span> <span class="nc">List</span><span class="o">((</span><span class="mi">0</span><span class="o">,</span><span class="mi">2</span><span class="o">),</span> <span class="o">(</span><span class="mi">1</span><span class="o">,</span><span class="mi">3</span><span class="o">),</span> <span class="o">(</span><span class="mi">2</span><span class="o">,</span><span class="mi">4</span><span class="o">),</span> <span class="o">(</span><span class="mi">1</span><span class="o">,</span><span class="mi">3</span><span class="o">),</span> <span class="o">(</span><span class="mi">2</span><span class="o">,</span><span class="mi">4</span><span class="o">),</span> <span class="o">(</span><span class="mi">3</span><span class="o">,</span><span class="mi">5</span><span class="o">),</span> <span class="o">(</span><span class="mi">2</span><span class="o">,</span><span class="mi">5</span><span class="o">),</span> <span class="o">(</span><span class="mi">3</span><span class="o">,</span><span class="mi">6</span><span class="o">),</span> <span class="o">(</span><span class="mi">4</span><span class="o">,</span><span class="mi">7</span><span class="o">),</span> <span class="o">(</span><span class="mi">3</span><span class="o">,</span><span class="mi">7</span><span class="o">),</span> <span class="o">(</span><span class="mi">4</span><span class="o">,</span><span class="mi">8</span><span class="o">),</span> <span class="o">(</span><span class="mi">5</span><span class="o">,</span><span class="mi">9</span><span class="o">))</span>
</code></pre></div><p>表达式的返回值类型是 <code class="highlighter-rouge">Option</code></p><div class="language-scala highlighter-rouge"><pre class="highlight"><code><span class="n">scala</span><span class="o">&gt;</span> <span class="k">val</span> <span class="n">list4</span> <span class="k">=</span> <span class="nc">List</span><span class="o">((</span><span class="mi">0</span> <span class="o">-&gt;</span> <span class="mi">1</span><span class="o">),(</span><span class="mi">0</span> <span class="o">-&gt;</span> <span class="mi">2</span><span class="o">),(</span><span class="mi">0</span> <span class="o">-&gt;</span> <span class="mi">3</span><span class="o">),(</span><span class="mi">1</span> <span class="o">-&gt;</span> <span class="mi">4</span><span class="o">),(</span><span class="mi">2</span> <span class="o">-&gt;</span> <span class="mi">5</span><span class="o">),(</span><span class="mi">3</span> <span class="o">-&gt;</span> <span class="mi">6</span><span class="o">))</span>
<span class="n">list4</span><span class="k">:</span> <span class="kt">List</span><span class="o">[(</span><span class="kt">Int</span>, <span class="kt">Int</span><span class="o">)]</span> <span class="k">=</span> <span class="nc">List</span><span class="o">((</span><span class="mi">0</span><span class="o">,</span><span class="mi">1</span><span class="o">),</span> <span class="o">(</span><span class="mi">0</span><span class="o">,</span><span class="mi">2</span><span class="o">),</span> <span class="o">(</span><span class="mi">0</span><span class="o">,</span><span class="mi">3</span><span class="o">),</span> <span class="o">(</span><span class="mi">1</span><span class="o">,</span><span class="mi">4</span><span class="o">),</span> <span class="o">(</span><span class="mi">2</span><span class="o">,</span><span class="mi">5</span><span class="o">),</span> <span class="o">(</span><span class="mi">3</span><span class="o">,</span><span class="mi">6</span><span class="o">))</span>

<span class="n">scala</span><span class="o">&gt;</span> <span class="n">list4</span><span class="o">.</span><span class="n">flatMap</span><span class="o">(</span><span class="n">x</span> <span class="k">=&gt;</span> <span class="k">if</span><span class="o">(</span><span class="n">x</span><span class="o">.</span><span class="n">_1</span> <span class="o">==</span> <span class="mi">0</span><span class="o">)</span> <span class="nc">None</span> <span class="k">else</span> <span class="nc">Some</span><span class="o">((</span><span class="n">x</span><span class="o">.</span><span class="n">_1</span><span class="o">,</span><span class="n">x</span><span class="o">.</span><span class="n">_2</span> <span class="o">*</span> <span class="mi">2</span><span class="o">)))</span>
<span class="n">res26</span><span class="k">:</span> <span class="kt">List</span><span class="o">[(</span><span class="kt">Int</span>, <span class="kt">Int</span><span class="o">)]</span> <span class="k">=</span> <span class="nc">List</span><span class="o">((</span><span class="mi">1</span><span class="o">,</span><span class="mi">8</span><span class="o">),</span> <span class="o">(</span><span class="mi">2</span><span class="o">,</span><span class="mi">10</span><span class="o">),</span> <span class="o">(</span><span class="mi">3</span><span class="o">,</span><span class="mi">12</span><span class="o">))</span>
</code></pre></div></article><div class="page-navigation"> <a class="next" href="/notes/%E5%A6%82%E4%BD%95%E5%9C%A8-Scala-%E4%B8%AD%E7%A7%91%E5%AD%A6%E5%9C%B0%E6%93%8D%E4%BD%9C-collection" title="NEXT: 如何在 scala 中科学地操作 collection">&lt;&lt;</a> <span> &middot; </span> <a class="home" href="/" title="Back to Homepage">Home</a></div></main><div class="footer"> <span class="block">Made with &hearts; using <a href="http://jekyllrb.com/" target="_blank">Jekyll</a> &amp; <a href="https://github.com/heiswayi/the-plain" title="The Plain theme by Heiswayi Nrird" target="_blank">The Plain</a> &middot; &lt;/&gt; on <a href="https://github.com/Shonrain" title="Hosted on GitHub" target="_blank">GitHub</a></span> <span class="block">&copy; 2017 ShawDubie</span></div></body></html>